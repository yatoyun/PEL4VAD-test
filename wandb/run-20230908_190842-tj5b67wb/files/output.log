
8000 8100 2900
[2023-09-08 19:08:44,434][main.py][line:165][INFO] total params:7.0450M
[2023-09-08 19:08:44,434][main.py][line:168][INFO] Training Mode
[2023-09-08 19:08:44,434][main.py][line:78][INFO] Model:XModel(
  (self_attention): XEncoder(
    (linear1): Conv1d(1024, 512, kernel_size=(1,), stride=(1,))
    (linear2): Conv1d(512, 300, kernel_size=(1,), stride=(1,))
    (dropout1): Dropout(p=0.1, inplace=False)
    (dropout2): Dropout(p=0.1, inplace=False)
    (norm): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (DR_DMU): WSAD(
      (embedding): Temporal(
        (conv_1): Sequential(
          (0): Conv1d(1024, 512, kernel_size=(3,), stride=(1,), padding=(1,))
          (1): ReLU()
        )
      )
      (triplet): TripletMarginLoss()
      (Amemory): Memory_Unit(
        (sig): Sigmoid()
      )
      (Nmemory): Memory_Unit(
        (sig): Sigmoid()
      )
      (selfatt): Transformer(
        (layers): ModuleList(
          (0-1): 2 x ModuleList(
            (0): PreNorm(
              (norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
              (fn): Attention(
                (attend): Softmax(dim=-1)
                (to_qkv): Linear(in_features=512, out_features=2048, bias=False)
                (to_out): Sequential(
                  (0): Linear(in_features=1024, out_features=512, bias=True)
                  (1): Dropout(p=0.1, inplace=False)
                )
              )
            )
            (1): PreNorm(
              (norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
              (fn): FeedForward(
                (net): Sequential(
                  (0): Linear(in_features=512, out_features=512, bias=True)
                  (1): GELU(approximate='none')
                  (2): Dropout(p=0.1, inplace=False)
                  (3): Linear(in_features=512, out_features=512, bias=True)
                  (4): Dropout(p=0.1, inplace=False)
                )
              )
            )
          )
        )
      )
      (encoder_mu): Sequential(
        (0): Linear(in_features=512, out_features=512, bias=True)
      )
      (encoder_var): Sequential(
        (0): Linear(in_features=512, out_features=512, bias=True)
      )
      (relu): ReLU()
    )
  )
  (classifier): Conv1d(300, 1, kernel_size=(9,), stride=(1,))
)
[2023-09-08 19:08:44,435][main.py][line:79][INFO] Optimizer:Adam (
Parameter Group 0
    amsgrad: False
    betas: (0.9, 0.999)
    capturable: False
    differentiable: False
    eps: 1e-08
    foreach: None
    fused: None
    lr: 0.0001
    maximize: False
    weight_decay: 5e-05
)
[2023-09-08 19:08:49,843][main.py][line:82][INFO] Random initialize AUCAUC:0.6061 Anomaly AUC:0.57717
[2023-09-08 19:09:04,020][main.py][line:106][INFO] [Epoch:1/100]: lr:0.00010 | loss1:0.2538 loss2:1.3731 loss3:0.3813 | AUC:0.7852 Anomaly AUC:0.5808
[2023-09-08 19:09:17,889][main.py][line:106][INFO] [Epoch:2/100]: lr:0.00010 | loss1:0.0173 loss2:1.1980 loss3:0.2868 | AUC:0.7732 Anomaly AUC:0.6507
[2023-09-08 19:09:31,889][main.py][line:106][INFO] [Epoch:3/100]: lr:0.00010 | loss1:0.0119 loss2:1.0135 loss3:0.2194 | AUC:0.7969 Anomaly AUC:0.6528
[2023-09-08 19:09:45,968][main.py][line:106][INFO] [Epoch:4/100]: lr:0.00010 | loss1:0.0126 loss2:0.9563 loss3:0.1613 | AUC:0.7977 Anomaly AUC:0.6549
[2023-09-08 19:10:00,274][main.py][line:106][INFO] [Epoch:5/100]: lr:0.00010 | loss1:0.0129 loss2:0.9179 loss3:0.1089 | AUC:0.7456 Anomaly AUC:0.6181
[2023-09-08 19:10:14,662][main.py][line:106][INFO] [Epoch:6/100]: lr:0.00010 | loss1:0.0106 loss2:0.9171 loss3:0.0835 | AUC:0.8110 Anomaly AUC:0.6684
[2023-09-08 19:10:29,099][main.py][line:106][INFO] [Epoch:7/100]: lr:0.00010 | loss1:0.0074 loss2:0.8753 loss3:0.0572 | AUC:0.7831 Anomaly AUC:0.6340
[2023-09-08 19:10:43,582][main.py][line:106][INFO] [Epoch:8/100]: lr:0.00010 | loss1:0.0049 loss2:0.8449 loss3:0.0409 | AUC:0.8161 Anomaly AUC:0.6588
[2023-09-08 19:10:58,136][main.py][line:106][INFO] [Epoch:9/100]: lr:0.00010 | loss1:0.0024 loss2:0.8141 loss3:0.0275 | AUC:0.8250 Anomaly AUC:0.6619
[2023-09-08 19:11:12,772][main.py][line:106][INFO] [Epoch:10/100]: lr:0.00010 | loss1:0.0073 loss2:0.8225 loss3:0.0401 | AUC:0.8130 Anomaly AUC:0.6618
[2023-09-08 19:11:27,358][main.py][line:106][INFO] [Epoch:11/100]: lr:0.00010 | loss1:0.0023 loss2:0.7833 loss3:0.0245 | AUC:0.8339 Anomaly AUC:0.6633
[2023-09-08 19:11:41,871][main.py][line:106][INFO] [Epoch:12/100]: lr:0.00010 | loss1:0.0030 loss2:0.7585 loss3:0.0239 | AUC:0.8223 Anomaly AUC:0.6439
[2023-09-08 19:11:56,452][main.py][line:106][INFO] [Epoch:13/100]: lr:0.00010 | loss1:0.0027 loss2:0.7335 loss3:0.0209 | AUC:0.8299 Anomaly AUC:0.6365
[2023-09-08 19:12:10,983][main.py][line:106][INFO] [Epoch:14/100]: lr:0.00010 | loss1:0.0030 loss2:0.7068 loss3:0.0178 | AUC:0.8196 Anomaly AUC:0.6301
[2023-09-08 19:12:25,563][main.py][line:106][INFO] [Epoch:15/100]: lr:0.00010 | loss1:0.0324 loss2:0.8600 loss3:0.0832 | AUC:0.8114 Anomaly AUC:0.6314
[2023-09-08 19:12:40,086][main.py][line:106][INFO] [Epoch:16/100]: lr:0.00010 | loss1:0.0027 loss2:0.7500 loss3:0.0212 | AUC:0.8268 Anomaly AUC:0.6219
[2023-09-08 19:12:54,665][main.py][line:106][INFO] [Epoch:17/100]: lr:0.00010 | loss1:0.0026 loss2:0.7118 loss3:0.0226 | AUC:0.8080 Anomaly AUC:0.5923
[2023-09-08 19:13:09,183][main.py][line:106][INFO] [Epoch:18/100]: lr:0.00010 | loss1:0.0011 loss2:0.6714 loss3:0.0112 | AUC:0.8273 Anomaly AUC:0.6146
[2023-09-08 19:13:23,773][main.py][line:106][INFO] [Epoch:19/100]: lr:0.00010 | loss1:0.0011 loss2:0.6454 loss3:0.0107 | AUC:0.8342 Anomaly AUC:0.6291
[2023-09-08 19:13:38,302][main.py][line:106][INFO] [Epoch:20/100]: lr:0.00010 | loss1:0.0007 loss2:0.6208 loss3:0.0073 | AUC:0.8324 Anomaly AUC:0.6199
[2023-09-08 19:13:52,872][main.py][line:106][INFO] [Epoch:21/100]: lr:0.00010 | loss1:0.0023 loss2:0.6062 loss3:0.0086 | AUC:0.8435 Anomaly AUC:0.6523
[2023-09-08 19:14:07,403][main.py][line:106][INFO] [Epoch:22/100]: lr:0.00010 | loss1:0.0009 loss2:0.5811 loss3:0.0075 | AUC:0.8378 Anomaly AUC:0.6307
[2023-09-08 19:14:21,995][main.py][line:106][INFO] [Epoch:23/100]: lr:0.00010 | loss1:0.0006 loss2:0.5514 loss3:0.0054 | AUC:0.8350 Anomaly AUC:0.6217
[2023-09-08 19:14:36,538][main.py][line:106][INFO] [Epoch:24/100]: lr:0.00010 | loss1:0.0008 loss2:0.5287 loss3:0.0052 | AUC:0.8150 Anomaly AUC:0.5883
[2023-09-08 19:14:51,141][main.py][line:106][INFO] [Epoch:25/100]: lr:0.00010 | loss1:0.0007 loss2:0.5008 loss3:0.0041 | AUC:0.8393 Anomaly AUC:0.6342
[2023-09-08 19:15:05,710][main.py][line:106][INFO] [Epoch:26/100]: lr:0.00010 | loss1:0.0004 loss2:0.4679 loss3:0.0026 | AUC:0.8386 Anomaly AUC:0.6337
[2023-09-08 19:15:20,333][main.py][line:106][INFO] [Epoch:27/100]: lr:0.00010 | loss1:0.0004 loss2:0.4393 loss3:0.0014 | AUC:0.8436 Anomaly AUC:0.6428
[2023-09-08 19:15:34,873][main.py][line:106][INFO] [Epoch:28/100]: lr:0.00010 | loss1:0.0914 loss2:0.5966 loss3:0.0409 | AUC:0.8163 Anomaly AUC:0.6148
[2023-09-08 19:15:49,541][main.py][line:106][INFO] [Epoch:29/100]: lr:0.00010 | loss1:0.0216 loss2:0.8298 loss3:0.0366 | AUC:0.8016 Anomaly AUC:0.5576
[2023-09-08 19:16:04,166][main.py][line:106][INFO] [Epoch:30/100]: lr:0.00010 | loss1:0.0040 loss2:0.6397 loss3:0.0060 | AUC:0.8126 Anomaly AUC:0.5728
[2023-09-08 19:16:18,780][main.py][line:106][INFO] [Epoch:31/100]: lr:0.00010 | loss1:0.0006 loss2:0.5521 loss3:0.0014 | AUC:0.8075 Anomaly AUC:0.5637
[2023-09-08 19:16:33,335][main.py][line:106][INFO] [Epoch:32/100]: lr:0.00010 | loss1:0.0006 loss2:0.5041 loss3:0.0008 | AUC:0.8120 Anomaly AUC:0.5722
[2023-09-08 19:16:47,979][main.py][line:106][INFO] [Epoch:33/100]: lr:0.00010 | loss1:0.0004 loss2:0.4654 loss3:0.0005 | AUC:0.8205 Anomaly AUC:0.5871
[2023-09-08 19:17:02,558][main.py][line:106][INFO] [Epoch:34/100]: lr:0.00010 | loss1:0.0004 loss2:0.4362 loss3:0.0005 | AUC:0.8172 Anomaly AUC:0.5818
[2023-09-08 19:17:17,199][main.py][line:106][INFO] [Epoch:35/100]: lr:0.00010 | loss1:0.0004 loss2:0.4122 loss3:0.0004 | AUC:0.8181 Anomaly AUC:0.5873
[2023-09-08 19:17:31,836][main.py][line:106][INFO] [Epoch:36/100]: lr:0.00010 | loss1:0.0004 loss2:0.3855 loss3:0.0004 | AUC:0.8211 Anomaly AUC:0.5912
[2023-09-08 19:17:46,516][main.py][line:106][INFO] [Epoch:37/100]: lr:0.00010 | loss1:0.0003 loss2:0.3593 loss3:0.0003 | AUC:0.8243 Anomaly AUC:0.5940
[2023-09-08 19:18:01,162][main.py][line:106][INFO] [Epoch:38/100]: lr:0.00010 | loss1:0.0003 loss2:0.3357 loss3:0.0003 | AUC:0.8223 Anomaly AUC:0.5921
Exception in thread Thread-120 (_pin_memory_loop):
Traceback (most recent call last):
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/threading.py", line 953, in run
    self._target(*self._args, **self._kwargs)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/utils/data/_utils/pin_memory.py", line 51, in _pin_memory_loop
    do_one_step()
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/utils/data/_utils/pin_memory.py", line 28, in do_one_step
    r = in_queue.get(timeout=MP_STATUS_CHECK_INTERVAL)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/queues.py", line 122, in get
    return _ForkingPickler.loads(res)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/multiprocessing/reductions.py", line 307, in rebuild_storage_fd
    fd = df.detach()
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/resource_sharer.py", line 57, in detach
    with _resource_sharer.get_connection(self._id) as conn:
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/resource_sharer.py", line 86, in get_connection
    c = Client(address, authkey=process.current_process().authkey)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/connection.py", line 502, in Client
    c = SocketClient(address)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/connection.py", line 630, in SocketClient
    s.connect(address)
FileNotFoundError: [Errno 2] No such file or directory
Exception in thread Thread-119 (_pin_memory_loop):
Traceback (most recent call last):
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/threading.py", line 953, in run
    self._target(*self._args, **self._kwargs)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/utils/data/_utils/pin_memory.py", line 51, in _pin_memory_loop
    do_one_step()
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/utils/data/_utils/pin_memory.py", line 28, in do_one_step
    r = in_queue.get(timeout=MP_STATUS_CHECK_INTERVAL)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/queues.py", line 122, in get
    return _ForkingPickler.loads(res)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/multiprocessing/reductions.py", line 307, in rebuild_storage_fd
    fd = df.detach()
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/resource_sharer.py", line 58, in detach
    return reduction.recv_handle(conn)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/reduction.py", line 189, in recv_handle
    return recvfds(s, 1)[0]
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/reduction.py", line 157, in recvfds
    msg, ancdata, flags, addr = sock.recvmsg(1, socket.CMSG_SPACE(bytes_size))
ConnectionResetError: [Errno 104] Connection reset by peer
Traceback (most recent call last):
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/main.py", line 203, in <module>
    main(cfg)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/main.py", line 170, in main
    train(model, train_nloader, train_aloader, test_loader, gt, logger)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/main.py", line 90, in train
    loss1, loss2, cost = train_func(train_nloader, train_aloader, model, optimizer, criterion, criterion2, criterion3, logger_wandb, args.lamda, args.alpha)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/train.py", line 43, in train_func
    loss1 = CLAS2(logits, label, seq_len, criterion)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/loss.py", line 17, in CLAS2
    ins_logits = torch.cat((ins_logits, tmp))
KeyboardInterrupt