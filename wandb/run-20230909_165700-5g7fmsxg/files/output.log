
8000 8100 2900
[2023-09-09 16:57:02,372][main.py][line:165][INFO] total params:7.5605M
[2023-09-09 16:57:02,372][main.py][line:168][INFO] Training Mode
[2023-09-09 16:57:02,372][main.py][line:78][INFO] Model:XModel(
  (self_attention): XEncoder(
    (self_attn): TCA(
      (q): Linear(in_features=1024, out_features=128, bias=True)
      (k): Linear(in_features=1024, out_features=128, bias=True)
      (v): Linear(in_features=1024, out_features=128, bias=True)
      (o): Linear(in_features=128, out_features=1024, bias=True)
      (act): Softmax(dim=-1)
    )
    (linear1): Conv1d(1024, 512, kernel_size=(1,), stride=(1,))
    (linear2): Conv1d(512, 300, kernel_size=(1,), stride=(1,))
    (dropout1): Dropout(p=0.5, inplace=False)
    (dropout2): Dropout(p=0.5, inplace=False)
    (norm): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    (loc_adj): DistanceAdj()
    (DR_DMU): WSAD(
      (embedding): Temporal(
        (conv_1): Sequential(
          (0): Conv1d(1024, 512, kernel_size=(3,), stride=(1,), padding=(1,))
          (1): ReLU()
        )
      )
      (triplet): TripletMarginLoss()
      (Amemory): Memory_Unit(
        (sig): Sigmoid()
      )
      (Nmemory): Memory_Unit(
        (sig): Sigmoid()
      )
      (selfatt): Transformer(
        (layers): ModuleList(
          (0-1): 2 x ModuleList(
            (0): PreNorm(
              (norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
              (fn): Attention(
                (attend): Softmax(dim=-1)
                (to_qkv): Linear(in_features=512, out_features=2048, bias=False)
                (to_out): Sequential(
                  (0): Linear(in_features=1024, out_features=512, bias=True)
                  (1): Dropout(p=0.5, inplace=False)
                )
              )
            )
            (1): PreNorm(
              (norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
              (fn): FeedForward(
                (net): Sequential(
                  (0): Linear(in_features=512, out_features=512, bias=True)
                  (1): GELU(approximate='none')
                  (2): Dropout(p=0.5, inplace=False)
                  (3): Linear(in_features=512, out_features=512, bias=True)
                  (4): Dropout(p=0.5, inplace=False)
                )
              )
            )
          )
        )
      )
      (encoder_mu): Sequential(
        (0): Linear(in_features=512, out_features=512, bias=True)
      )
      (encoder_var): Sequential(
        (0): Linear(in_features=512, out_features=512, bias=True)
      )
      (relu): ReLU()
    )
  )
  (classifier): Conv1d(300, 1, kernel_size=(9,), stride=(1,))
  (dropout): Dropout(p=0.5, inplace=False)
)
[2023-09-09 16:57:02,373][main.py][line:79][INFO] Optimizer:Adam (
Parameter Group 0
    amsgrad: False
    betas: (0.9, 0.999)
    capturable: False
    differentiable: False
    eps: 1e-08
    foreach: None
    fused: None
    initial_lr: 0.0005
    lr: 0.0005
    maximize: False
    weight_decay: 5e-05
)
[2023-09-09 16:57:10,451][main.py][line:82][INFO] Random initialize AUCAUC:0.5550 Anomaly AUC:0.47816
[2023-09-09 16:57:28,810][main.py][line:106][INFO] [Epoch:1/100]: lr:0.00050 | loss1:1.0163 loss2:1.3286 loss3:0.3111 | AUC:0.8074 Anomaly AUC:0.6068
[2023-09-09 16:57:46,953][main.py][line:106][INFO] [Epoch:2/100]: lr:0.00050 | loss1:0.5516 loss2:1.1775 loss3:0.1860 | AUC:0.7944 Anomaly AUC:0.5879
[2023-09-09 16:58:05,446][main.py][line:106][INFO] [Epoch:3/100]: lr:0.00050 | loss1:0.4270 loss2:1.1181 loss3:0.1587 | AUC:0.7946 Anomaly AUC:0.5790
[2023-09-09 16:58:24,098][main.py][line:106][INFO] [Epoch:4/100]: lr:0.00050 | loss1:0.3385 loss2:1.0850 loss3:0.1290 | AUC:0.8009 Anomaly AUC:0.5722
[2023-09-09 16:58:42,878][main.py][line:106][INFO] [Epoch:5/100]: lr:0.00050 | loss1:0.2859 loss2:1.0704 loss3:0.0824 | AUC:0.8150 Anomaly AUC:0.5651
[2023-09-09 16:59:01,697][main.py][line:106][INFO] [Epoch:6/100]: lr:0.00050 | loss1:0.2114 loss2:1.0408 loss3:0.0276 | AUC:0.7966 Anomaly AUC:0.5895
[2023-09-09 16:59:20,614][main.py][line:106][INFO] [Epoch:7/100]: lr:0.00050 | loss1:0.1835 loss2:1.0210 loss3:0.0172 | AUC:0.7916 Anomaly AUC:0.5818
[2023-09-09 16:59:39,642][main.py][line:106][INFO] [Epoch:8/100]: lr:0.00050 | loss1:0.1732 loss2:1.0094 loss3:0.0146 | AUC:0.7922 Anomaly AUC:0.5837
[2023-09-09 16:59:58,502][main.py][line:106][INFO] [Epoch:9/100]: lr:0.00050 | loss1:0.0856 loss2:0.9807 loss3:0.0070 | AUC:0.7511 Anomaly AUC:0.5475
[2023-09-09 17:00:17,438][main.py][line:106][INFO] [Epoch:10/100]: lr:0.00050 | loss1:0.0889 loss2:0.9710 loss3:0.0068 | AUC:0.7772 Anomaly AUC:0.5576
[2023-09-09 17:00:36,410][main.py][line:106][INFO] [Epoch:11/100]: lr:0.00050 | loss1:0.0576 loss2:0.9560 loss3:0.0045 | AUC:0.7901 Anomaly AUC:0.5615
[2023-09-09 17:00:55,390][main.py][line:106][INFO] [Epoch:12/100]: lr:0.00050 | loss1:0.0761 loss2:0.9493 loss3:0.0057 | AUC:0.8036 Anomaly AUC:0.5677
[2023-09-09 17:01:14,361][main.py][line:106][INFO] [Epoch:13/100]: lr:0.00050 | loss1:0.0387 loss2:0.9353 loss3:0.0031 | AUC:0.7757 Anomaly AUC:0.5627
[2023-09-09 17:01:33,369][main.py][line:106][INFO] [Epoch:14/100]: lr:0.00050 | loss1:0.0667 loss2:0.9335 loss3:0.0050 | AUC:0.8011 Anomaly AUC:0.5881
[2023-09-09 17:01:52,412][main.py][line:106][INFO] [Epoch:15/100]: lr:0.00050 | loss1:0.0351 loss2:0.9150 loss3:0.0028 | AUC:0.7466 Anomaly AUC:0.5552
[2023-09-09 17:02:11,304][main.py][line:106][INFO] [Epoch:16/100]: lr:0.00050 | loss1:0.0397 loss2:0.9095 loss3:0.0030 | AUC:0.7892 Anomaly AUC:0.5714
[2023-09-09 17:02:30,293][main.py][line:106][INFO] [Epoch:17/100]: lr:0.00050 | loss1:0.0335 loss2:0.8911 loss3:0.0025 | AUC:0.7738 Anomaly AUC:0.5587
[2023-09-09 17:02:49,310][main.py][line:106][INFO] [Epoch:18/100]: lr:0.00050 | loss1:0.0857 loss2:0.8906 loss3:0.0073 | AUC:0.7908 Anomaly AUC:0.5640
[2023-09-09 17:03:08,270][main.py][line:106][INFO] [Epoch:19/100]: lr:0.00050 | loss1:0.0985 loss2:0.8865 loss3:0.0070 | AUC:0.7972 Anomaly AUC:0.5863
[2023-09-09 17:03:27,371][main.py][line:106][INFO] [Epoch:20/100]: lr:0.00050 | loss1:0.0612 loss2:0.7741 loss3:0.0025 | AUC:0.7589 Anomaly AUC:0.5163
[2023-09-09 17:03:46,420][main.py][line:106][INFO] [Epoch:21/100]: lr:0.00050 | loss1:0.0571 loss2:0.6241 loss3:0.0029 | AUC:0.8003 Anomaly AUC:0.5590
[2023-09-09 17:04:05,436][main.py][line:106][INFO] [Epoch:22/100]: lr:0.00050 | loss1:0.0350 loss2:0.5374 loss3:0.0024 | AUC:0.7942 Anomaly AUC:0.5986
[2023-09-09 17:04:24,556][main.py][line:106][INFO] [Epoch:23/100]: lr:0.00050 | loss1:0.0367 loss2:0.4406 loss3:0.0025 | AUC:0.8094 Anomaly AUC:0.6258
[2023-09-09 17:04:43,643][main.py][line:106][INFO] [Epoch:24/100]: lr:0.00050 | loss1:0.0410 loss2:0.3567 loss3:0.0032 | AUC:0.7385 Anomaly AUC:0.5857
[2023-09-09 17:05:02,768][main.py][line:106][INFO] [Epoch:25/100]: lr:0.00050 | loss1:0.0158 loss2:0.2346 loss3:0.0015 | AUC:0.8070 Anomaly AUC:0.6091
[2023-09-09 17:05:21,770][main.py][line:106][INFO] [Epoch:26/100]: lr:0.00050 | loss1:0.0583 loss2:0.1987 loss3:0.0041 | AUC:0.8110 Anomaly AUC:0.5794
[2023-09-09 17:05:40,901][main.py][line:106][INFO] [Epoch:27/100]: lr:0.00050 | loss1:0.0289 loss2:0.1150 loss3:0.0022 | AUC:0.7658 Anomaly AUC:0.5487
[2023-09-09 17:06:00,084][main.py][line:106][INFO] [Epoch:28/100]: lr:0.00050 | loss1:0.0171 loss2:0.0626 loss3:0.0015 | AUC:0.7953 Anomaly AUC:0.5715
[2023-09-09 17:06:19,316][main.py][line:106][INFO] [Epoch:29/100]: lr:0.00050 | loss1:0.0394 loss2:0.0698 loss3:0.0027 | AUC:0.8092 Anomaly AUC:0.5902
Exception in thread Thread-93 (_pin_memory_loop):
Traceback (most recent call last):
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/threading.py", line 1016, in _bootstrap_inner
    self.run()
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/threading.py", line 953, in run
    self._target(*self._args, **self._kwargs)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/utils/data/_utils/pin_memory.py", line 51, in _pin_memory_loop
    do_one_step()
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/utils/data/_utils/pin_memory.py", line 28, in do_one_step
    r = in_queue.get(timeout=MP_STATUS_CHECK_INTERVAL)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/queues.py", line 122, in get
    return _ForkingPickler.loads(res)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/multiprocessing/reductions.py", line 307, in rebuild_storage_fd
    fd = df.detach()
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/resource_sharer.py", line 58, in detach
    return reduction.recv_handle(conn)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/reduction.py", line 189, in recv_handle
    return recvfds(s, 1)[0]
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/multiprocessing/reduction.py", line 157, in recvfds
    msg, ancdata, flags, addr = sock.recvmsg(1, socket.CMSG_SPACE(bytes_size))
ConnectionResetError: [Errno 104] Connection reset by peer
Traceback (most recent call last):
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/main.py", line 203, in <module>
    main(cfg)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/main.py", line 170, in main
    train(model, train_nloader, train_aloader, test_loader, gt, logger)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/main.py", line 90, in train
    loss1, loss2, cost = train_func(train_nloader, train_aloader, model, optimizer, criterion, criterion2, criterion3, logger_wandb, args.lamda, args.alpha)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/train.py", line 30, in train_func
    logits, x_k, output_MSNSD = model(v_input, seq_len)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/model.py", line 37, in forward
    x_e, x_v = self.self_attention(x, seq_len)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/modules.py", line 33, in forward
    x_k = self.DR_DMU(x)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/DR_DMU/model.py", line 64, in forward
    else:
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/DR_DMU/translayer.py", line 76, in forward
    x = attn(x) + x
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/DR_DMU/translayer.py", line 14, in forward
    return self.fn(self.norm(x), **kwargs)
  File "/home/yukaneko/miniconda3/envs/detection/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/yukaneko/dev/AbnormalDetection/PEL4VAD/DR_DMU/translayer.py", line 55, in forward
    tmp_ones = torch.ones(n).cuda()
KeyboardInterrupt